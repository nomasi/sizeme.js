{"version":3,"sources":["sizeme-api.js"],"names":["i","s","o","g","r","a","m","q","push","arguments","l","Date","createElement","getElementsByTagName","async","src","parentNode","insertBefore","window","document","SizeMe","hasProp","hasOwnProperty","slice","authToken","_authToken","_facepalm","addMessageListener","createCORSRequest","createFitResponse","defaultErrorCallback","gaEnabled","removeMessageListener","contextAddress","gaTrackingID","pluginVersion","ga","version","XMLHttpRequest","callback","attachEvent","addEventListener","detachEvent","removeEventListener","method","service","errorCallback","url","xhr","XDomainRequest","getTime","onload","onerror","open","console","error","onreadystatechange","readyState","status","setRequestHeader","statusText","log","trackEvent","action","label","name","this","hitType","eventCategory","location","hostname","eventAction","eventLabel","getAuthToken","cb","iframe","event","tokenObj","origin","data","body","removeChild","setAttribute","appendChild","JSON","parse","responseText","withCredentials","send","getProductInfo","sku","encodeURIComponent","fitResponse","response","responseMap","size","Map","call","matchMap","fromObject","addItem","prototype","fetchProfilesForAccount","match","fitRequest","successCallback","stringify","loginFrame","options","e","logout","key","value","addItems","items","j","ref","length","Error","obj","k","map","v","FitRequest","profileId","item","Item","itemType","itemLayer","itemThickness","itemStretch","fitRecommendation","measurements","addSize","addOption","FitRange","ranges","too_small","start","end","slim","regular","loose","too_big","getFitRangeLabels","getFitRangeLabel","fitValue","range","result","results"],"mappings":"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","file":"sizeme-api.min.js","sourcesContent":["(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){\n        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),\n    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)\n})(window,document,'script','//www.google-analytics.com/analytics.js','ga');\n\n\n/*\n Helper object to handle the communication to the SizeMe server.\n  Exposes two functions to fetch the profiles for the accountInfo and\n  get the match results for the items.\n\n  @version 2.0\n */\n\n(function() {\n  var SizeMe,\n    hasProp = {}.hasOwnProperty,\n    slice = [].slice;\n\n  SizeMe = (function() {\n\n    /*\n      Address for the SizeMe API service\n     */\n    var _authToken, _facepalm, addMessageListener, createCORSRequest, createFitResponse, defaultErrorCallback, gaEnabled, removeMessageListener;\n\n    SizeMe.contextAddress = \"https://www.sizeme.com\";\n\n    SizeMe.gaTrackingID = \"UA-40735596-1\";\n\n    SizeMe.pluginVersion = \"UNKNOWN\";\n\n    gaEnabled = false;\n\n    ga(function() {\n      return gaEnabled = SizeMe.gaTrackingID != null;\n    });\n\n\n    /*\n      Version of the API\n     */\n\n    SizeMe.version = \"2.3\";\n\n    _authToken = void 0;\n\n    _facepalm = !(\"withCredentials\" in new XMLHttpRequest());\n\n\n    /*\n      Creates a new instance of SizeMe\n    \n      @param [Object] authToken the authentication token for the SizeMe service,\n        obtained with the {SizeMe.getAuthToken} method.\n     */\n\n    function SizeMe(authToken) {\n      _authToken = authToken;\n    }\n\n    addMessageListener = function(callback) {\n      if (window.attachEvent != null) {\n        return window.attachEvent(\"onmessage\", callback);\n      } else {\n        return window.addEventListener(\"message\", callback);\n      }\n    };\n\n    removeMessageListener = function(callback) {\n      if (window.detachEvent != null) {\n        return window.detachEvent(\"onmessage\", callback);\n      } else {\n        return window.removeEventListener(\"message\", callback);\n      }\n    };\n\n    createCORSRequest = function(method, service, callback, errorCallback) {\n      var url, xhr;\n      xhr = void 0;\n      url = \"\" + SizeMe.contextAddress + service;\n      if (!_facepalm) {\n        xhr = new XMLHttpRequest();\n        xhr.onreadystatechange = function() {\n          if (xhr.readyState === 4) {\n            if (xhr.status >= 200 && xhr.status < 300) {\n              return callback(xhr);\n            } else {\n              return errorCallback(xhr);\n            }\n          }\n        };\n        xhr.open(method, url, true);\n        if (_authToken != null) {\n          xhr.setRequestHeader(\"Authorization\", \"Bearer \" + _authToken);\n        }\n        if (gaEnabled) {\n          xhr.setRequestHeader(\"X-Analytics-Enabled\", \"true\");\n        }\n        xhr.setRequestHeader(\"X-Sizeme-Pluginversion\", SizeMe.pluginVersion);\n      } else if (typeof XDomainRequest !== \"undefined\" && XDomainRequest !== null) {\n        xhr = new XDomainRequest();\n        url = url + \"?_tm=\" + (new Date().getTime());\n        if (_authToken != null) {\n          url = url + \"&authToken=\" + _authToken;\n        }\n        if (gaEnabled) {\n          url = url + \"&analyticsEnabled=true\";\n        }\n        url = url + \"&pluginVersion=\" + SizeMe.pluginVersion;\n        xhr.onload = function() {\n          return callback(xhr);\n        };\n        xhr.onerror = function() {\n          return errorCallback(xhr);\n        };\n        xhr.open(method, url, true);\n      } else {\n        console.error(\"Unsupported browser\");\n      }\n      return xhr;\n    };\n\n    defaultErrorCallback = function(xhr, status, statusText) {\n      if (window.console && console.log) {\n        return console.log(\"Error: \" + statusText + \" (\" + status + \")\");\n      }\n    };\n\n    SizeMe.trackEvent = function(action, label) {\n      if (SizeMe.gaTrackingID != null) {\n        ga(\"create\", SizeMe.gaTrackingID, \"auto\", {\n          name: \"sizemeTracker\"\n        });\n        this.trackEvent = function(a, l) {\n          return ga(\"sizemeTracker.send\", {\n            hitType: \"event\",\n            eventCategory: window.location.hostname,\n            eventAction: a,\n            eventLabel: l\n          });\n        };\n        return this.trackEvent(action, label);\n      }\n    };\n\n\n    /*\n      Tries to fetch a new auth token from the SizeMe service. User needs to be\n      logged in to the service to receive a valid token.\n    \n      The returned token is passed as an argument to the callback function. If\n      user is not logged in, the returned token is null.\n    \n      This function is executed asynchronously, so it will return immediately.\n    \n      @param [Function] callback\n        function to execute after the request is completed\n      @param [Function] errorCallback function to execute if there was an error\n     */\n\n    SizeMe.getAuthToken = function(callback, errorCallback) {\n      var cb, iframe, xhr;\n      if (errorCallback == null) {\n        errorCallback = defaultErrorCallback;\n      }\n      if (_facepalm) {\n        iframe = document.createElement(\"iframe\");\n        cb = function(event) {\n          var tokenObj;\n          if (event.origin === SizeMe.contextAddress) {\n            tokenObj = event.data;\n            removeMessageListener(cb);\n            document.body.removeChild(iframe);\n            if (callback != null) {\n              if (typeof callback === \"function\") {\n                callback(tokenObj);\n              }\n            }\n          }\n        };\n        addMessageListener(cb);\n        iframe.setAttribute(\"src\", SizeMe.contextAddress + \"/api/authToken.html\");\n        iframe.setAttribute(\"style\", \"display:none\");\n        document.body.appendChild(iframe);\n      } else {\n        xhr = createCORSRequest(\"GET\", \"/api/authToken\", function(xhr) {\n          return callback(JSON.parse(xhr.responseText));\n        }, function(xhr) {\n          return errorCallback(xhr, xhr.status, xhr.statusText);\n        });\n        xhr.withCredentials = true;\n        xhr.send();\n      }\n    };\n\n\n    /*\n      Fetches the sizing information for a group of products based on the given\n      SKU. If SKU refers to a parent product, all it's children are returned. If\n      it refers to a child product, only that child is returned.\n    \n      @param [String] sku The SKU of the product/product group\n      @param [Function] callback\n        function to execute after the request is completed\n      @param [Function] errorCallback function to execute if there was an error\n     */\n\n    SizeMe.getProductInfo = function(sku, callback, errorCallback) {\n      var xhr;\n      if (errorCallback == null) {\n        errorCallback = defaultErrorCallback;\n      }\n      xhr = createCORSRequest(\"GET\", \"/api/products/\" + (encodeURIComponent(sku)), function(xhr) {\n        return callback(JSON.parse(xhr.responseText));\n      }, function(xhr) {\n        return errorCallback(xhr, xhr.status, xhr.statusText);\n      });\n      xhr.send();\n    };\n\n    createFitResponse = function(xhr) {\n      var fitResponse, response, responseMap, size;\n      response = JSON.parse(xhr.responseText);\n      responseMap = new SizeMe.Map();\n      for (size in response) {\n        if (!hasProp.call(response, size)) continue;\n        fitResponse = response[size];\n        fitResponse.matchMap = SizeMe.Map.fromObject(fitResponse.matchMap);\n        responseMap.addItem(size, fitResponse);\n      }\n      return responseMap;\n    };\n\n\n    /*\n      Fetches an array of profiles for the accountInfo.\n      The format of the profile objects is\n    \n          {\n            \"type\": \"object\",\n            \"properties\": {\n              \"id\": {\n                \"type\": \"string\",\n                \"description\": \"id of the profile.\"\n              },\n              \"profileName\": {\n                \"type\": \"string\",\n                \"description\": \"name of the profile.\"\n              }\n            }\n          }\n    \n      The array is passed as an argument to the callback function.\n      This function is executed asynchronously, so it will return immediately.\n    \n      @param [Object] callback\n        function to execute after the request is completed\n      @param [Function] errorCallback function to execute if there was an error\n    \n      @return [Object] profile\n     */\n\n    SizeMe.prototype.fetchProfilesForAccount = function(callback, errorCallback) {\n      if (errorCallback == null) {\n        errorCallback = defaultErrorCallback;\n      }\n      createCORSRequest(\"GET\", \"/api/profiles\", function(xhr) {\n        SizeMe.trackEvent(\"fetchProfiles\", \"API: fetchProfiles\");\n        return callback(JSON.parse(xhr.responseText));\n      }, function(xhr) {\n        return errorCallback(xhr, xhr.status, xhr.statusText);\n      }).send();\n      return void 0;\n    };\n\n\n    /*\n      Calls the matching service with the measurements of the item to be matched\n      against the selected profile.\n    \n      The result is an associative array mapping size labels to response objects.\n      The format of a response object is\n    \n          {\n            \"type\": \"object\",\n            \"properties\": {\n              \"fitRangeLabel\": {\n                \"type\": \"string\",\n                \"enum\": [\n                  \"too_small\",\n                  \"slim\",\n                  \"regular\",\n                  \"loose\",\n                  \"huge\",\n                  \"too_big\"\n                ],\n                \"description\": \"A label defining the range of the total fit.\"\n              },\n              \"totalFit\": {\n                \"type\": \"integer\",\n                \"description\": \"A total fit of the item. 100 is a perfect match.\"\n              },\n              \"matchMap\": {\n                \"type\": \"object\",\n                \"description\": \"An associative array containing the detailed fit\n                                for each measuring property\"\n              },\n              \"accuracy\": {\n                \"type\": \"number\",\n                \"description\": \"An accuracy percentage, ie. the percentage of\n                                measurement points of the item compared\n                                to the points specified in the profile\"\n              },\n              \"missingMeasurements\": {\n                \"type\": \"array\",\n                \"description\": \"An array of the measurement points that were\n                                missing in the profile. The items in the array\n                                are themselves also arrays of the size two;\n                                first item is the measurement's item property,\n                                the second is the property's human name\"\n              }\n            }\n          }\n    \n      The response object contains an associative array (property matchMap)\n      that maps each measuring property to a match object The format of a\n      match object is\n    \n          {\n            \"type\": \"object\",\n            \"properties\": {\n              \"overlap\": {\n                \"type\": \"integer\",\n                \"description\": \"difference of the item's measure\n                                (with corrective factors) and the\n                                person's measure\".\n              },\n              \"percentage\": {\n                \"type\": \"number\",\n                \"description\": \"the percentage of the overlap.\"\n              },\n              \"componentFit\": {\n                \"type\": \"integer\",\n                \"description\": \"component's fit value.\"\n              },\n            }\n          }\n    \n      The response object is passed as an argument to the\n      successCallback-function.\n      This function is executed asynchronously, so it will return immediately.\n    \n      @param [SizeMe.FitRequest] fitrequest\n        instance containing profile and item information\n      @param [Function] successCallback function to call if match succeeds\n      @param [Function] errorCallback function to call if there's an error\n     */\n\n    SizeMe.prototype.match = function(fitRequest, successCallback, errorCallback) {\n      var data, xhr;\n      if (errorCallback == null) {\n        errorCallback = defaultErrorCallback;\n      }\n      data = JSON.stringify(fitRequest);\n      xhr = createCORSRequest(\"POST\", \"/api/compareSizes\", function(xhr) {\n        SizeMe.trackEvent(\"match\", \"API: match\");\n        return successCallback(createFitResponse(xhr));\n      }, function(xhr) {\n        return errorCallback(xhr, xhr.status, xhr.statusText);\n      });\n      if (xhr.setRequestHeader != null) {\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n      }\n      xhr.send(data);\n      return void 0;\n    };\n\n\n    /*\n      Open the login frame and set the callback function for logging in\n    \n      @param loggedInCallback [Function]\n        the function to execute when user logs themselves in\n     */\n\n    SizeMe.loginFrame = function(callback) {\n      var cb, options, url;\n      url = SizeMe.contextAddress + \"/remote-login.html\";\n      options = \"height=375,width=349,left=200,top=200,location=no,menubar=no, resizable=no,scrollbars=no,toolbar=no\";\n      cb = function(e) {\n        if (e.origin === SizeMe.contextAddress) {\n          removeMessageListener(cb);\n          if (e.data) {\n            SizeMe.trackEvent(\"apiLogin\", \"API: login\");\n            return callback();\n          }\n        }\n      };\n      addMessageListener(cb);\n      window.open(url, \"loginframe\", options);\n      SizeMe.trackEvent(\"loginFrame\", \"API: loginFrame\");\n    };\n\n\n    /*\n      Logout from SizeMe\n    \n      @param callback [Function]\n        callback to execute after logout\n     */\n\n    SizeMe.logout = function(callback) {\n      var cb, iframe;\n      iframe = document.createElement(\"iframe\");\n      cb = function(event) {\n        if (event.origin === SizeMe.contextAddress && event.data === \"logout\") {\n          removeMessageListener(cb);\n          document.body.removeChild(iframe);\n          SizeMe.trackEvent(\"apiLogout\", \"API: logout\");\n          if (callback != null) {\n            callback();\n          }\n        }\n      };\n      addMessageListener(cb);\n      iframe.setAttribute(\"src\", SizeMe.contextAddress + \"/remote-logout\");\n      iframe.setAttribute(\"style\", \"display:none\");\n      return document.body.appendChild(iframe);\n    };\n\n    return SizeMe;\n\n  })();\n\n\n  /*\n    A simple map implementation to help pass the item properties to server\n   */\n\n  SizeMe.Map = (function() {\n    function Map() {}\n\n\n    /*\n      Adds an item to this map. Returns itself so that this method can be used\n      in a chain.\n    \n      @param [*] key the key for the value\n      @param [*] value value to be added\n      @return [SizeMe.Map]\n     */\n\n    Map.prototype.addItem = function(key, value) {\n      this[key] = value;\n      return this;\n    };\n\n\n    /*\n      Adds multiple items at a time to this map. Returns itself so that this\n      method can be used in a chain.\n    \n      @param [*] arguments\n        items to add as key/value-pairs, ie. key1, value1, key2, value2, ...\n      @return [SizeMe.Map]\n     */\n\n    Map.prototype.addItems = function() {\n      var i, items, j, ref;\n      items = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n      if (items.length % 2 !== 0) {\n        throw new Error('Arguments must be \"tuples\" (example: (key1, value1, key2, value2, ...)');\n      }\n      for (i = j = 0, ref = items.length; j < ref; i = j += 2) {\n        this.addItem(items[i], items[i + 1]);\n      }\n      return this;\n    };\n\n\n    /*\n      Creates a new SizeMe.Map from an arbitrary object\n    \n      @param [Object] obj the object to transform\n     */\n\n    Map.fromObject = function(obj) {\n      var k, map, v;\n      map = new SizeMe.Map();\n      for (k in obj) {\n        if (!hasProp.call(obj, k)) continue;\n        v = obj[k];\n        map.addItem(k, v);\n      }\n      return map;\n    };\n\n    return Map;\n\n  })();\n\n\n  /*\n      Request object used to make the match requests to the server\n   */\n\n  SizeMe.FitRequest = (function() {\n\n    /*\n      @param [String] profileId the id of the profile\n      @param [SizeMe.Item, String] item\n        object containing size information or SKU of the product\n     */\n    function FitRequest(profileId, item) {\n      this.profileId = profileId;\n      if (typeof item === \"string\") {\n        this.sku = item;\n      } else {\n        this.item = item;\n      }\n    }\n\n    return FitRequest;\n\n  })();\n\n\n  /*\n  A class for holding the information for specific item.\n   */\n\n  SizeMe.Item = (function() {\n\n    /*\n      @param [String] itemType the type of the Item\n      @param [Number] itemLayer optional layer information\n      @param [Number] itemThickness optional thickness value of the Item\n      @param [Number] itemStretch optional stretch value of the Item\n      @param [Number] fitRecommendation optional value for a fit recommendation\n     */\n    function Item(itemType, itemLayer, itemThickness, itemStretch, fitRecommendation) {\n      this.itemType = itemType;\n      this.itemLayer = itemLayer != null ? itemLayer : 0;\n      this.itemThickness = itemThickness != null ? itemThickness : 0;\n      this.itemStretch = itemStretch != null ? itemStretch : 0;\n      this.fitRecommendation = fitRecommendation != null ? fitRecommendation : 0;\n      this.measurements = new SizeMe.Map();\n    }\n\n\n    /*\n      Adds a new size information to this item.\n    \n      @param {*} size the label for the size\n      @param {SizeMe.Map} measurements a map of \"property->measurement\" pairs.\n      @return {SizeMe.Item}\n      @deprecated Use addOption instead\n     */\n\n    Item.prototype.addSize = function(size, measurements) {\n      this.measurements.addItem(size, measurements);\n      return this;\n    };\n\n\n    /*\n      Adds a new selection option to this item.\n    \n      @param {*} label the label for the option\n      @param {SizeMe.Map} measurements a map of \"property->measurement\" pairs.\n      @return {SizeMe.Item}\n     */\n\n    Item.prototype.addOption = function(label, measurements) {\n      this.measurements.addItem(label, measurements);\n      return this;\n    };\n\n    return Item;\n\n  })();\n\n  SizeMe.FitRange = (function() {\n    var ranges;\n\n    function FitRange() {}\n\n    ranges = {\n      too_small: {\n        start: 0,\n        end: 1000\n      },\n      slim: {\n        start: 1000,\n        end: 1050\n      },\n      regular: {\n        start: 1050,\n        end: 1110\n      },\n      loose: {\n        start: 1110,\n        end: 1170\n      },\n      too_big: {\n        start: 1170,\n        end: 99990\n      }\n    };\n\n    FitRange.getFitRangeLabels = function() {\n      return ranges;\n    };\n\n    FitRange.getFitRangeLabel = function(fitValue) {\n      var label, range, result;\n      result = (function() {\n        var results;\n        results = [];\n        for (label in ranges) {\n          if (!hasProp.call(ranges, label)) continue;\n          range = ranges[label];\n          if (range.start <= fitValue && range.end > fitValue) {\n            results.push(label);\n          }\n        }\n        return results;\n      })();\n      return result;\n    };\n\n    return FitRange;\n\n  })();\n\n  window.SizeMe = SizeMe;\n\n}).call(this);\n"],"sourceRoot":"/source/"}